<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="rgb(255,255,255)"><title>&#183; jonasg.io </title><meta name=title content="Your Tests Also Need Some Architecting &#183; jonasg.io "><script type=text/javascript src=/js/appearance.min.022d0ebc3b46a335eb1c7ef79b7f2de143d7cd5156d433638592ef1ce5f8554e.js integrity="sha256-Ai0OvDtGozXrHH73m38t4UPXzVFW1DNjhZLvHOX4VU4="></script><link type=text/css rel=stylesheet href=/css/main.bundle.min.18ac715ee0ef31ccb3489b9f5dacc8b2c95d2ce05804c075e005a59adcd670ef.css integrity="sha256-GKxxXuDvMcyzSJufXazIssldLOBYBMB14AWlmtzWcO8="><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.584bbad802c9a2b9301e29557fa688dc72062b2386b655a7a19c02c3a1d36248.js integrity="sha256-WEu62ALJorkwHilVf6aI3HIGKyOGtlWnoZwCw6HTYkg=" data-copy=Copy data-copied=Copied></script><meta name=description content="
      Discover how the Object Mother concept empowers developers to effortlessly generate intricate test objects, enhancing code readability, maintainability, and overall testing efficiency.
    "><link rel=canonical href=https://jonasg.io/talks/your-tests-also-need-some-architecting/><link rel=alternate type=application/rss+xml href=/talks/your-tests-also-need-some-architecting/index.xml title="jonasg.io "><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Your Tests Also Need Some Architecting"><meta property="og:description" content="Discover how the Object Mother concept empowers developers to effortlessly generate intricate test objects, enhancing code readability, maintainability, and overall testing efficiency."><meta property="og:type" content="website"><meta property="og:url" content="https://jonasg.io/talks/your-tests-also-need-some-architecting/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Your Tests Also Need Some Architecting"><meta name=twitter:description content="Discover how the Object Mother concept empowers developers to effortlessly generate intricate test objects, enhancing code readability, maintainability, and overall testing efficiency."><meta name=author content="Jonas Geiregat"><link href=https://github.com/jonasgeiregat rel=me><link href=https://www.linkedin.com/in/jonas-geiregat-a8421a31 rel=me><link href=https://twitter.com/jonas_grgt rel=me><script async src="https://www.googletagmanager.com/gtag/js?id=G-ZPY1Q2T661"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZPY1Q2T661",{anonymize_ip:!1})}</script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold pe-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral print:hidden sm:py-10"><nav class="flex items-start justify-between sm:items-center"><div class="z-40 flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>jonasg.io</a></div><label id=menu-button for=menu-controller class="block sm:hidden"><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="fixed inset-0 z-30 invisible w-full h-full m-auto overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex flex-col w-full px-6 py-6 mx-auto overflow-visible list-none max-w-7xl text-end sm:px-14 sm:py-10 sm:pt-10 md:px-24 lg:px-32"><li class=mb-1><span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class="mb-1 group"><a href=/posts/ title="Jonas on Software"><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li><li class="mb-1 group"><a href title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Projects</span></a></li><li class="mb-1 group"><a href=/talks/ title="My Talks"><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Talks</span></a></li><li class="mb-1 group"><button id=search-button-1 title="Search (/)">
<span class="transition-colors group-dark:hover:text-primary-400 group-hover:text-primary-600"><span class="relative inline-block align-text-bottom px-1 icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li></ul></div></label><ul class="flex-row hidden list-none text-end sm:flex"><li class="mb-1 group sm:mb-0 sm:me-7 sm:last:me-0"><a href=/posts/ title="Jonas on Software"><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li><li class="mb-1 group sm:mb-0 sm:me-7 sm:last:me-0"><a href title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Projects</span></a></li><li class="mb-1 group sm:mb-0 sm:me-7 sm:last:me-0"><a href=/talks/ title="My Talks"><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Talks</span></a></li><li class="mb-1 group sm:mb-0 sm:me-7 sm:last:me-0"><button id=search-button-2 title="Search (/)">
<span class="transition-colors group-dark:hover:text-primary-400 group-hover:text-primary-600"><span class="relative inline-block align-text-bottom px-1 icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><header><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/></a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/talks/>My Talks</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/talks/your-tests-also-need-some-architecting/>Your Tests Also Need Some Architecting</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Your Tests Also Need Some Architecting</h1></header><section class="mt-0 prose flex max-w-full flex-col dark:prose-invert lg:flex-row"><div class="min-w-0 min-h-0 max-w-prose grow"><p>Discover how the Object Mother concept empowers developers to effortlessly generate intricate test objects,
enhancing code readability, maintainability, and overall testing efficiency.</p><h2 id=the-creational-problem class="relative group">The creational problem <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-creational-problem aria-label=Anchor>#</a></span></h2><p>A good structured test exists out of three parts commonly known as: Given When Then or Arrange Act Assert.</p><p>Within the <em>Given</em> part you declare a set of objects that will drive your test.
Initially the creational logic is simple, as the objects may have fewer fields or lack coherence.
However, inevitably over time, the set of objects grows as their intricacy, they become more complex and
time-consuming to construct.</p><p>Various solutions exist to address those issues, such as <em>Test Data Factories</em>, <em>Data Fakers</em>,
<em>Test Data Generators</em> or <em>Fixture Builders</em> etc ..
In the end they all share a common goal: <b style=color:#3da6b1>simplifying</b> object creation while ensuring <b style=color:#3da6b1>reusability</b>.
Martin Fowler has even coined a term for this concept, known as
<a href=https://martinfowler.com/bliki/ObjectMother.html target=_blank rel=noreferrer>Object Mother</a>.</p><p>Let&rsquo;s delve deeper into the problem by examining a concrete example. While this example may not be overly complex or
entirely realistic, the purpose of this article is to work with practical scenarios without getting bogged down in the
intricacies of object creation.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Address</span><span class=w> </span><span class=n>billingAddress</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Address</span><span class=p>.</span><span class=na>Builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>streetAddress</span><span class=p>(</span><span class=s>&#34;123 Main St&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>city</span><span class=p>(</span><span class=s>&#34;Anytown&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>state</span><span class=p>(</span><span class=s>&#34;CA&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>zipCode</span><span class=p>(</span><span class=s>&#34;12345&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>country</span><span class=p>(</span><span class=n>Country</span><span class=p>.</span><span class=na>US</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Address</span><span class=w> </span><span class=n>shippingAddress</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Address</span><span class=p>.</span><span class=na>Builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>streetAddress</span><span class=p>(</span><span class=s>&#34;456 Oak Ave&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>city</span><span class=p>(</span><span class=s>&#34;Othertown&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>state</span><span class=p>(</span><span class=s>&#34;CA&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>zipCode</span><span class=p>(</span><span class=s>&#34;67890&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>country</span><span class=p>(</span><span class=n>Country</span><span class=p>.</span><span class=na>US</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>InvoiceItem</span><span class=o>&gt;</span><span class=w> </span><span class=n>items</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>items</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>InvoiceItem</span><span class=p>(</span><span class=s>&#34;Product A&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Amount</span><span class=p>.</span><span class=na>EUR</span><span class=p>(</span><span class=n>100</span><span class=p>.</span><span class=na>00</span><span class=p>),</span><span class=w> </span><span class=n>Tax</span><span class=p>.</span><span class=na>vatPercentage</span><span class=p>(</span><span class=n>21</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>items</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>InvoiceItem</span><span class=p>(</span><span class=s>&#34;Product B&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Amount</span><span class=p>.</span><span class=na>EUR</span><span class=p>(</span><span class=n>100</span><span class=p>.</span><span class=na>00</span><span class=p>),</span><span class=w> </span><span class=n>Tax</span><span class=p>.</span><span class=na>vatPercentage</span><span class=p>(</span><span class=n>21</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Customer</span><span class=w> </span><span class=n>customer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Customer</span><span class=p>.</span><span class=na>Builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>name</span><span class=p>(</span><span class=s>&#34;John Doe&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>email</span><span class=p>(</span><span class=s>&#34;john.doe@example.com&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>phoneNumber</span><span class=p>(</span><span class=s>&#34;555-123-4567&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Invoice</span><span class=w> </span><span class=n>invoice</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Invoice</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>InvoiceNumber</span><span class=p>(</span><span class=s>&#34;001&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>customer</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>billingAddressm</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>shippingAddress</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>LocalDate</span><span class=p>.</span><span class=na>now</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>items</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Amount</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>invoice</span><span class=p>.</span><span class=na>getVatAmount</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>assertThat</span><span class=p>(</span><span class=n>amount</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>Amount</span><span class=p>.</span><span class=na>EUR</span><span class=p>(</span><span class=n>42</span><span class=p>))</span><span class=w>
</span></span></span></code></pre></div><p>In the case of the aforementioned test, an Invoice object is needed, which, in turn, depends on several other objects.
However, it is noteworthy that, for this specific test, <b style=color:#3da6b1>only the invoice items hold significance</b>. They play a vital role
in asserting and calculating the VAT amount, all the other objects and fields just <b style=color:#3da6b1>clutter the readability of the test</b>.</p><h2 id=test-data---factory-generator-builder-fixtures- class="relative group">Test Data - Factory, Generator, Builder, Fixtures &mldr; <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#test-data---factory-generator-builder-fixtures- aria-label=Anchor>#</a></span></h2><p>There are numerous patterns available to create the required objects for your tests.
A very common approach to simplify the creational logic while at the same time having some kind of of code reuse in place
is to create <strong>static factory methods</strong> returning the required objects.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>InvoiceTestDataFactory</span><span class=p>.</span><span class=na>invoice</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>While this approach may initially appear to solve the creational issue, it tends to scale poorly
As <a href=https://martinfowler.com/bliki/ObjectMother.html target=_blank rel=noreferrer>Martin Fowler</a> highlights:</p><blockquote><p>Object Mothers do have their faults. In particular there&rsquo;s a heavy coupling in that many tests will depend on the exact data in the mothers.</p></blockquote><p>I&rsquo;ve observed several solutions to address this issue, including;</p><ul><li>creating specific static factory methods</li><li>adding parameters to differentiate the creational logic.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>InvoiceTestDataFactory</span><span class=p>.</span><span class=na>invoiceWithoutShippingAddress</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>InvoiceTestDataFactory</span><span class=p>.</span><span class=na>invoiceWithoutBillingAddressAndThreeItems</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>InvoiceTestDataFactory</span><span class=p>.</span><span class=na>invoice</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>InvoiceNumber</span><span class=p>(</span><span class=s>&#34;001&#34;</span><span class=p>),</span><span class=w> </span><span class=s>&#34;john@doe,com&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>InvoiceTestDataFactory</span><span class=p>.</span><span class=na>invoice</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>InvoiceItem</span><span class=p>(</span><span class=s>&#34;Product A&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Amount</span><span class=p>.</span><span class=na>EUR</span><span class=p>(</span><span class=n>100</span><span class=p>.</span><span class=na>00</span><span class=p>),</span><span class=w> </span><span class=n>Tax</span><span class=p>.</span><span class=na>vatPercentage</span><span class=p>(</span><span class=n>21</span><span class=p>)),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>InvoiceItem</span><span class=p>(</span><span class=s>&#34;Product B&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Amount</span><span class=p>.</span><span class=na>EUR</span><span class=p>(</span><span class=n>100</span><span class=p>.</span><span class=na>00</span><span class=p>),</span><span class=w> </span><span class=n>Tax</span><span class=p>.</span><span class=na>vatPercentage</span><span class=p>(</span><span class=n>21</span><span class=p>)));</span><span class=w>
</span></span></span></code></pre></div><p>While these solutions may initially appear to solve the coupling issue, they often result in tight coupling between
specific factory methods and the requirements of individual tests, limiting their reusability.</p><p>One introduces <em>different</em> factory methods or several sets of parameters because there are tests that require <em>different</em>
<em>permutations</em> of the same objects under test.</p><p>Imagine you have an object with 5 primitive fields and 5 custom-typed fields. The question arises: how many permutations
of factory methods or parameter sets would be required to cover all your test cases?</p><p>Introducing static factory methods or parameters might make the code challenging to maintain and may not facilitate effective communication within the
Given part of your tests. Ultimately, pursuing this path leads to test data factories that are difficult to maintain
and confusing to use.</p><p>So, how can we <b style=color:#3da6b1>simplify the technical creational logic while simultaneously highlighting its essential aspects</b>?</p><h2 id=emphasize-what-matters-and-hide-the-irrelevant-parts class="relative group">Emphasize what matters and hide the irrelevant parts <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#emphasize-what-matters-and-hide-the-irrelevant-parts aria-label=Anchor>#</a></span></h2><p>By combining the Object Mother concept with <b style=color:#3da6b1>pre-filled builders</b> it becomes possible to hide away all unnecessary
complexity while at the same time <b style=color:#3da6b1>emphasizing what matters</b> for your test-case.</p><p>Let&rsquo;s put this into practice using the previous example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Invoice</span><span class=w> </span><span class=n>invoice</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>InvoiceMother</span><span class=p>.</span><span class=na>invoice</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>withInvoiceItems</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>InvoiceItem</span><span class=p>(</span><span class=s>&#34;Product A&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Amount</span><span class=p>.</span><span class=na>EUR</span><span class=p>(</span><span class=n>100</span><span class=p>.</span><span class=na>00</span><span class=p>),</span><span class=w> </span><span class=n>Tax</span><span class=p>.</span><span class=na>vatPercentage</span><span class=p>(</span><span class=n>21</span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>InvoiceItem</span><span class=p>(</span><span class=s>&#34;Product B&#34;</span><span class=p>,</span><span class=w> </span><span class=n>Amount</span><span class=p>.</span><span class=na>EUR</span><span class=p>(</span><span class=n>100</span><span class=p>.</span><span class=na>00</span><span class=p>),</span><span class=w> </span><span class=n>Tax</span><span class=p>.</span><span class=na>vatPercentage</span><span class=p>(</span><span class=n>21</span><span class=p>)))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Amount</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>invoice</span><span class=p>.</span><span class=na>getVatAmount</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>assertThat</span><span class=p>(</span><span class=n>amount</span><span class=p>).</span><span class=na>isEqualTo</span><span class=p>(</span><span class=n>Amount</span><span class=p>.</span><span class=na>EUR</span><span class=p>(</span><span class=n>42</span><span class=p>))</span><span class=w>
</span></span></span></code></pre></div><p>üëâÔ∏è It&rsquo;s important to <b style=color:#3da6b1>stress the prefilled nature of a mother.</b>
Calling <code>InvoiceMother.invoice().build()</code> will return a fully fledged <code>Invoice</code> were all fields are filled
in containing <b style=color:#3da6b1>sensible default values</b>.</p><p>By utilizing the approach mentioned above, the unnecessary clutter is eliminated, allowing the focus to be solely on
what is essential for the test. In this particular case, it becomes evident that having two invoice items priced at
EUR 100 each, with a 21% tax applied to each item, results in EUR 42 of taxes</p><p>We are still using some kind of <em>static factory method,</em> yet it does not immediately return our Invoice rather it returns
a <b style=color:#3da6b1>builder</b> that allows you to override those defaults <b style=color:#3da6b1>that matter for your specific test</b>.</p><p>I like to make the builder part of the Mother class as to reduce the chance to confuse it with production
code InvoiceBuilders.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>InvoiceMother</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=nf>InvoiceMother</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Builder</span><span class=w> </span><span class=nf>invoice</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Builder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>class</span> <span class=nc>Builder</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>InvoiceNumber</span><span class=w> </span><span class=n>invoiceNumber</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>InvoiceNumber</span><span class=p>(</span><span class=s>&#34;001&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Customer</span><span class=w> </span><span class=n>customer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CustomerMother</span><span class=p>.</span><span class=na>customer</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Address</span><span class=w> </span><span class=n>billingAddress</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>AddressMother</span><span class=p>.</span><span class=na>address</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Address</span><span class=w> </span><span class=n>shippingAddress</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>AddressMother</span><span class=p>.</span><span class=na>address</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>LocalDate</span><span class=w> </span><span class=n>creationDate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDate</span><span class=p>.</span><span class=na>now</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>InvoiceItem</span><span class=o>&gt;</span><span class=w> </span><span class=n>items</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>InvoiceItemMother</span><span class=p>.</span><span class=na>item</span><span class=p>().</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=n>Builder</span><span class=w> </span><span class=nf>withItems</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>InvoiceItem</span><span class=o>&gt;</span><span class=w> </span><span class=n>items</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=na>items</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>items</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// other setters are left out for brevity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>public</span><span class=w> </span><span class=n>Invoice</span><span class=w> </span><span class=nf>build</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Invoice</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>invoiceNumber</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>customer</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>billingAddressm</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>shippingAddress</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>creationDate</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>items</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>It&rsquo;s important to note that the concept discussed here is not about the suffix &lsquo;Mother.&rsquo;
If you find the suffix unfavorable, feel free to use any other suffix that better suits your needs, such as
<em>InvoiceTestDataFactory,</em> <em>InvoiceFixture,</em> <em>InvoiceTestData,</em> and so on.</p><p>What is important:</p><ul><li>Let your factory methods return <em>Builders</em> not the object under creation.</li><li>Use a <b style=color:#3da6b1>pre-filled Builder</b></li><li><b style=color:#3da6b1>Limit</b> your <b style=color:#3da6b1>static factory methods</b> to the absolute minimum.</li><li>Rather <b style=color:#3da6b1>override a field using the Builder</b> than to introduce a new static factory method.</li></ul><p>What can flex:</p><ul><li>Let the defaults for custom complex objects depend on other Mothers</li><li>The Mother suffix</li><li>Making the Builder part of your Mother class</li></ul><p>But what if your test requires a specific field in one of the nested custom objects to be in a particular state?
For instance, you may need the shipping address&rsquo;s country to be set as &lsquo;US,&rsquo; while the other field values are irrelevant
for your test.
With the current setup, you would have to pass in another mother object and build it fully changing only that field that
matter for your test.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>InvoiceMother</span><span class=p>.</span><span class=na>invoice</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>withShippingAddress</span><span class=p>(</span><span class=n>AddressMother</span><span class=p>.</span><span class=na>addres</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>withCountry</span><span class=p>(</span><span class=n>Country</span><span class=p>.</span><span class=na>US</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>Although this approach works, we can further improve it by utilizing a <code>java.util.function.Consumer</code> with
the <code>AddressMother.Builder</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>InvoiceMother</span><span class=p>.</span><span class=na>invoice</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>withShippingAddress</span><span class=p>(</span><span class=n>b</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=na>withCountry</span><span class=p>(</span><span class=n>Country</span><span class=p>.</span><span class=na>US</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>In this case, the builder method would look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=n>Builder</span><span class=w> </span><span class=nf>withShippingAddress</span><span class=p>(</span><span class=n>Consumer</span><span class=o>&lt;</span><span class=n>AddressMother</span><span class=p>.</span><span class=na>Builder</span><span class=o>&gt;</span><span class=w> </span><span class=n>addressConsumer</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Address</span><span class=p>.</span><span class=na>Builder</span><span class=w> </span><span class=n>builder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>AddressMother</span><span class=p>.</span><span class=na>address</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>addressConsumer</span><span class=p>.</span><span class=na>accept</span><span class=p>(</span><span class=n>builder</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>shippingAddress</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>builder</span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>These enhancements aim to improve the readability and clarity of the code example while retaining the original meaning
and intent.</p><h2 id=takeaways class="relative group">Takeaways <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#takeaways aria-label=Anchor>#</a></span></h2><p>In conclusion, the Object Mother concept offers developers a powerful approach to effortlessly generate intricate
test objects. By combining the concept with pre-filled builders, developers can effectively simplify the technical
creational logic while emphasizing the essential aspects of their test cases.</p><p>By embracing the Object Mother concept and its principles, developers can achieve enhanced code readability,
maintainability, and overall testing efficiency in their software projects. This becomes particularly crucial in complex
projects, as tests serve not only to verify code correctness and guide design but also to serve as documentation and
prevention of regression. When regression does occur, it is vital for both your future self and colleagues to clearly
understand what is being tested.</p></div></section><section class="mt-10 prose dark:prose-invert"><p class="py-8 border-t"><em>There's no articles to list here yet.</em></p></section><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2023
Jonas Geiregat</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://github.com/jpanther/congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="flex flex-row items-center"></div></div></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://jonasg.io><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>